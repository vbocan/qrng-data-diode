services:
  qrng-collector:
    build:
      context: ..
      dockerfile: qrng-collector/Dockerfile
    image: ghcr.io/vbocan/qrng-collector:latest
    container_name: qrng-collector
    restart: unless-stopped

    # Load environment variables from .env file
    env_file:
      - .env

    # Additional environment variables
    environment:
      - RUST_LOG=${LOG_LEVEL:-info}

    # Health check (monitor logs since no HTTP endpoint)
    healthcheck:
      test: ["CMD-SHELL", "pgrep -f qrng-collector || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

    # Resource limits (optional - can be uncommented if needed)
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '1.0'
    #       memory: 256M
    #     reservations:
    #       cpus: '0.5'
    #       memory: 128M

    # Logging configuration
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
